{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-121cee6a\"],{bb51:function(e,t,o){\"use strict\";o.r(t);var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o(\"div\",{staticClass:\"room\"},[o(\"div\",{ref:\"video-box\",staticClass:\"video-box\"},[o(\"video\",{staticClass:\"video-mine\",attrs:{autoplay:\"\",controls:\"\"}})])])},a=[],c=o(\"29b2\"),n={name:\"home\",data(){return{roomid:\"\",peer:null,peerList:{},candidate:null,localStream:null}},watch:{userList:{handler(){},deep:!0}},beforeDestroy(){for(let e in this.peerList)this.peerList[e].close(),this.peerList[e]=null},mounted(){console.log(this.$route.params),this.$nextTick(()=>{this.getUserMedia().then(()=>{c[\"a\"].emit(\"join\",{roomid:this.$route.params.roomid,account:this.$route.params.account})}),this.socketInit()})},methods:{getUserMedia(){let e=this.$refs[\"vedio-mine\"],t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return new Promise((o,i)=>{t.call(navigator,{audio:!0,video:!0},t=>{e.srcObject=t,this.localStream=t,o()},(function(e){i(e)}))})},socketInit(){c[\"a\"].on(\"joined\",(e,t)=>{if(e.length>1&&(e.forEach(e=>{let t={},o=[e.account,this.$route.params.account];t.account=o.sort().join(\"-\"),this.peerList[t.account]||e.account===this.$route.params.account||this.getPeerConnection(t)}),t===this.$route.params.account))for(let o in this.peerList)this.createOffer(o,this.peerList[o])}),c[\"a\"].on(\"offer\",e=>{this.peerList[e.account]&&this.peerList[e.account].setRemoteDescription(e.sdp,()=>{this.peerList[e.account].createAnswer().then(t=>{this.peerList[e.account].setLocalDescription(t,()=>{c[\"a\"].emit(\"answer\",{sdp:this.peerList[e.account].localDescription,roomid:this.$route.params.roomid,account:e.account})})})},e=>{console.log(e)})}),c[\"a\"].on(\"answer\",e=>{console.log(\"answer---\",e.sdp),this.peerList[e.account]&&this.peerList[e.account].setRemoteDescription(e.sdp,(function(){}),e=>{console.log(e)})}),c[\"a\"].on(\"__ice_candidate\",e=>{e.candidate&&this.peerList[e.account]&&this.peerList[e.account].addIceCandidate(e.candidate).catch(()=>{})}),c[\"a\"].on(\"disconnected\",e=>{let t=document.querySelector(\"#\"+e);t&&t.remove()})},getPeerConnection(e){let t=this.$refs[\"video-box\"],o={iceServers:[{url:\"stun:stun.l.google.com:19302\"}]},i=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,a=new i(o);a.addStream(this.localStram),a.onaddstream=function(o){let i=document.querySelector(\"#\"+e.account);if(i)i.srcObj=o.stream;else{let i=document.createElement(\"video\");i.controls=!0,i.autoplay=\"autoplay\",i.srcObject=o.stream,i.id=e.account,t.append(i)}},a.onicecandidate=t=>{t.candidate&&c[\"a\"].emit(\"__ice_candidate\",{candidate:t.candidate,roomid:this.$route.params.roomid,account:e.account})},this.peerList[e.account]=a},createOffer(e,t){t.createOffer({offerToRecieveAudio:1,offerToReceiveVideo:1}).then(o=>{t.selLocalDescription(o,()=>{c[\"a\"].emit(\"offer\",{sdp:t.localDescription,roomid:this.$route.params.roomid,account:e})})})},join(){this.account&&this.roomid&&this.$router.push({name:\"room\",params:{roomid:this.roomid,account:this.account}})}},components:{}},s=n,r=(o(\"ef7a\"),o(\"2877\")),d=Object(r[\"a\"])(s,i,a,!1,null,\"745200cb\",null);t[\"default\"]=d.exports},d7b8:function(e,t,o){},ef7a:function(e,t,o){\"use strict\";o(\"d7b8\")}}]);","extractedComments":[]}