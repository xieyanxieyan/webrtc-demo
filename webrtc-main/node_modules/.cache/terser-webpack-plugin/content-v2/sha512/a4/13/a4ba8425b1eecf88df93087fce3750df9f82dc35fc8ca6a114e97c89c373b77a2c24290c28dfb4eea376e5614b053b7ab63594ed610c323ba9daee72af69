{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-db2d2bc4\"],{\"76bc\":function(e,t,o){\"use strict\";o(\"94a7\")},\"94a7\":function(e,t,o){},bb51:function(e,t,o){\"use strict\";o.r(t);var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o(\"div\",{staticClass:\"room\"},[o(\"div\",{ref:\"video-box\",staticClass:\"video-box\"},[o(\"video\",{ref:\"video-mine\",staticClass:\"video-mine\",attrs:{autoplay:\"\",controls:\"\"}})])])},a=[],c=o(\"29b2\"),n={name:\"home\",data(){return{roomid:\"\",peer:null,peerList:{},candidate:null,localStream:null}},watch:{userList:{handler(){},deep:!0}},beforeDestroy(){for(let e in this.peerList)this.peerList[e].close(),this.peerList[e]=null},mounted(){console.log(this.$route.params,\"params----\\x3e\"),this.$nextTick(()=>{this.getUserMedia().then(()=>{c[\"a\"].emit(\"join\",{roomid:this.$route.params.roomid,account:this.$route.params.account})}),this.socketInit()})},methods:{getUserMedia(){return new Promise((e,t)=>{let o=this.$refs[\"video-mine\"],i=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;console.log(i,\"getUserMedia---\\x3e>\"),i.call(navigator,{audio:!0,video:!0},t=>{o.srcObject=t,this.localStream=t,e()},(function(e){t(e)}))})},socketInit(){c[\"a\"].on(\"joined\",(e,t)=>{if(e.length>1&&(e.forEach(e=>{let t={},o=[e.account,this.$route.params.account];t.account=o.sort().join(\"-\"),this.peerList[t.account]||e.account===this.$route.params.account||this.getPeerConnection(t)}),t===this.$route.params.account))for(let o in this.peerList)this.createOffer(o,this.peerList[o])}),c[\"a\"].on(\"offer\",e=>{this.peerList[e.account]&&this.peerList[e.account].setRemoteDescription(e.sdp,()=>{this.peerList[e.account].createAnswer().then(t=>{this.peerList[e.account].setLocalDescription(t,()=>{c[\"a\"].emit(\"answer\",{sdp:this.peerList[e.account].localDescription,roomid:this.$route.params.roomid,account:e.account})})})},e=>{console.log(e)})}),c[\"a\"].on(\"answer\",e=>{this.peerList[e.account]&&this.peerList[e.account].setRemoteDescription(e.sdp,(function(){}),e=>{console.log(e)})}),c[\"a\"].on(\"__ice_candidate\",e=>{e.candidate&&this.peerList[e.account]&&this.peerList[e.account].addIceCandidate(e.candidate).catch(()=>{})}),c[\"a\"].on(\"disconnected\",e=>{let t=document.querySelector(\"#\"+e);t&&t.remove()})},getPeerConnection(e){let t=this.$refs[\"video-box\"],o={iceServers:[{url:\"stun:stun.l.google.com:19302\"}]},i=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,a=new i(o);a.addStream(this.localStream),a.onaddstream=function(o){let i=document.querySelector(\"#a\"+e.account);if(i)i.srcObject=o.stream;else{let i=document.createElement(\"video\");i.controls=!0,i.autoplay=\"autoplay\",i.srcObject=o.stream,i.id=\"a\"+e.account,t.append(i)}},a.onicecandidate=t=>{t.candidate&&c[\"a\"].emit(\"__ice_candidate\",{candidate:t.candidate,roomid:this.$route.params.roomid,account:e.account})},this.peerList[e.account]=a},createOffer(e,t){t.createOffer({offerToRecieveAudio:1,offerToReceiveVideo:1}).then(o=>{t.setLocalDescription(o,()=>{c[\"a\"].emit(\"offer\",{sdp:t.localDescription,roomid:this.$route.params.roomid,account:e})})})}},components:{}},s=n,r=(o(\"76bc\"),o(\"2877\")),d=Object(r[\"a\"])(s,i,a,!1,null,\"21412e11\",null);t[\"default\"]=d.exports}}]);","extractedComments":[]}