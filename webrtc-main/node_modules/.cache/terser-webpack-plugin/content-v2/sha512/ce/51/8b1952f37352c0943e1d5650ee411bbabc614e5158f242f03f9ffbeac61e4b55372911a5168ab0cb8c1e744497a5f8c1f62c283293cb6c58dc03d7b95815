{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-182746fd\"],{a6d2:function(e,t,o){},bb51:function(e,t,o){\"use strict\";o.r(t);var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o(\"div\",{staticClass:\"room\"},[o(\"div\",{ref:\"video-box\",staticClass:\"video-box\"},[o(\"video\",{ref:\"video-mine\",staticClass:\"video-mine\",attrs:{autoplay:\"\",controls:\"\"}})])])},a=[],n=o(\"29b2\"),c={name:\"home\",data(){return{roomid:\"\",peer:null,peerList:{},candidate:null,localStream:null}},watch:{userList:{handler(){},deep:!0}},beforeDestroy(){for(let e in this.peerList)this.peerList[e].close(),this.peerList[e]=null},mounted(){console.log(this.$route.params,\"params----\\x3e\"),this.$nextTick(()=>{this.getUserMedia().then(()=>{n[\"a\"].emit(\"join\",{roomid:this.$route.params.roomid,account:this.$route.params.account})}),this.socketInit()})},methods:{getUserMedia(){let e=this.$refs[\"video-mine\"],t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return new Promise((o,i)=>{t.call(navigator,{audio:!0,video:!0},t=>{e.srcObject=t,this.localStream=t,o()},(function(e){i(e)}))})},socketInit(){n[\"a\"].on(\"joined\",(e,t)=>{if(e.length>1&&(e.forEach(e=>{let t={},o=[e.account,this.$route.params.account];t.account=o.sort().join(\"-\"),this.peerList[t.account]||e.account===this.$route.params.account||this.getPeerConnection(t)}),t===this.$route.params.account))for(let o in this.peerList)this.createOffer(o,this.peerList[o])}),n[\"a\"].on(\"offer\",e=>{this.peerList[e.account]&&this.peerList[e.account].setRemoteDescription(e.sdp,()=>{this.peerList[e.account].createAnswer().then(t=>{this.peerList[e.account].setLocalDescription(t,()=>{n[\"a\"].emit(\"answer\",{sdp:this.peerList[e.account].localDescription,roomid:this.$route.params.roomid,account:e.account})})})},e=>{console.log(e)})}),n[\"a\"].on(\"answer\",e=>{this.peerList[e.account]&&this.peerList[e.account].setRemoteDescription(e.sdp,(function(){}),e=>{console.log(e)})}),n[\"a\"].on(\"__ice_candidate\",e=>{e.candidate&&this.peerList[e.account]&&this.peerList[e.account].addIceCandidate(e.candidate).catch(()=>{})}),n[\"a\"].on(\"disconnected\",e=>{let t=document.querySelector(\"#\"+e);t&&t.remove()})},getPeerConnection(e){let t=this.$refs[\"video-box\"],o={iceServers:[{url:\"stun:stun.l.google.com:19302\"}]},i=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection,a=new i(o);a.addStream(this.localStream),a.onaddstream=function(o){let i=document.querySelector(\"#a\"+e.account);if(i)i.srcObject=o.stream;else{let i=document.createElement(\"video\");i.controls=!0,i.autoplay=\"autoplay\",i.srcObject=o.stream,i.id=\"a\"+e.account,t.append(i)}},a.onicecandidate=t=>{t.candidate&&n[\"a\"].emit(\"__ice_candidate\",{candidate:t.candidate,roomid:this.$route.params.roomid,account:e.account})},this.peerList[e.account]=a},createOffer(e,t){t.createOffer({offerToRecieveAudio:1,offerToReceiveVideo:1}).then(o=>{t.setLocalDescription(o,()=>{n[\"a\"].emit(\"offer\",{sdp:t.localDescription,roomid:this.$route.params.roomid,account:e})})})}},components:{}},s=c,r=(o(\"f922\"),o(\"2877\")),d=Object(r[\"a\"])(s,i,a,!1,null,\"5f28ff49\",null);t[\"default\"]=d.exports},f922:function(e,t,o){\"use strict\";o(\"a6d2\")}}]);","extractedComments":[]}